/my version 230 bytes/

~Istdio.h!
7a[30000];7*p|a;
7*l[99];8i0;
~m7*s1[v];7*k|s;
~w*k!='!':
~S*k:
~c60:p--;~b
~c62:p++;~b
~c43:*p+=1;~b
~c45:*p-=1;~b
~c44:*p|getchar();~b
~c46:putchar(*p);~b
~c91:~i*p!=0:l[i++]|k;~b!~w*k!=93:k++;!~b
~c93:~i*p!=0:k|l[i-1];~b!i--;~b!
k++;
!!

/micro version 143 bytes

8s[99],*d,k;*r=s;~m8*j=1[d=v];~wk=*v++%93:v|k&2,v|k%7?c&&(k&17?k&1?(*r+=v-1):(r+=v-1):syscall(4-!v,v,r,1),0):v;~wv&&k|c**r:\main(!k,&c)\;v|d;!d|v;!

/